### 一、区块链
#### 1.区块链的本质
+ 区块链的本质是一种特殊的分布式数据库。区块链的主要作用是存储信息，信息既可以写入区块链，也可以从区块链中读取。
+ 任何人都可以架设服务器加入区块链网络成为一个节点，区块链里面没有中心节点，所有节点都是平等的，都保存着整个数据库，可以向任何一个节点写入/读取数据，因为所有节点最后都会同步，保证区块链一直。

#### 2.区块
区块链由一个一个区块（block）组成，区块可以类比数据库的记录，每次向区块链写入数据，就是创建一个区块。每个区块包含两个部分：
+ 区块头（head）：记录当前区块的特征值
+ 区块体（body）：实际数据

特征值包含当前区块的多项特征值：
+ 生成时间
+ 实际数据（即区块体）的哈希
+ 上一个区块的哈希

两个重要推论：
+ 推论1：每个区块的哈希都是不一样的，可以通过哈希标识区块
+ 推论2：如果区块的内容变了，它的哈希一直会改变
> Hash = SHA256( 区块头 )

#### 3.采矿
采矿（mining）就是生成区块（计算哈希）的过程。由于必须保证节点之间的同步，所以新的区块生成速度不能太快。区块链的发明者故意让生成新区块变得困难，平均每10分钟，全网才能生成一个新的区块，一个小时也就6个。

区块的生成速度之所以这么慢是因为故意设置了海量的计算，也就是说，由于计算量太大，所以快不起来。计算哈希的机器就叫矿机，操作矿机的人就叫做矿工。

为什么说区块的生成需要海量的计算？原因是计算出来的哈希值只有满足条件才被接受，这个条件很苛刻，使得绝大部分哈希值都不满足要求，必须重算。

原来，区块头包含一个难度系统（difficulty），这个值决定了计算哈希的难度。区块链协议规定，使用一个常量除以难度系统，可以得到目标值（target），难度系统越大，目标值越小。还规定，哈希值必须小于目标值的哈希才是有效的，否则无效。由于目标值非常小，哈希小于该值得机会极其渺茫，可能计算10亿次才算中一次，这就是 **采矿如此之慢的根本原因**。

如果要对同一个区块反复计算哈希，就意味着区块头必须不停变化。但区块头里面的特征值都是固定的，因此区块链发明者故意曾了一个叫做 **Nonce** 的随机变量，Nonce是一个32位的二进制数。

#### 4.难度系统的动态调节
有些区块可能一分钟就算出来了，有些可能几个小时也没结果。为了将产出速率恒定在十分钟，设计值规定难度系统每两周调整一次。在这两周里如果区块的平均生成速度是9分钟，就意味着比规定的速度快了10%，因此接下来难度系统就要调高10%。

难度系统越调越高（目标值越来越小），导致采矿越来越难。

### 二、比特币
#### 1.非对称加密
非对称加密就是加密和解密需要两把钥匙：一把公钥和一把私钥。

公钥是公开的，私钥是保密的，私钥只有拥有者才能使用。他人使用你的公钥加密信息，然后发给你，你用私钥解密取出信息。反过来，你也可以用私钥加密信息，别人用你的公钥解开，从而证明信息是你发的且未被篡改，这就叫做数字签名。

现在设想：**如果公钥加密的不是普通信息，而是加密了一笔钱，发送给你，这会怎样？**。首先，你能解开加密包取出里面的钱，因为你有私钥；其次，别人无法偷走这笔钱，因为他们没有你的私钥，因此支付可以成。

这就是比特币（以及其它数字货币）的原理：非对称加密保证了支付的可靠性。

#### 2.比特币钱包
对于比特币来说，钱不是支付给个人的，而是支付给某一把私钥，这就是 **交易匿名性** 的根本原因，因为没人知道私钥的主人是谁。

网上的比特币交易所开户，他们会让你首先生成一个比特币钱包（wallet），这个钱包不是用来存放比特币的，而是存放你的公钥和私钥。

根据协议，公钥的长度是512位，这个长度不方便传播，因此协议又规定为公钥生成一个160位的指纹，即一个比较短、易于传播的哈希值，写成二进制大约是26到35个字符，如1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2，这个字符串就是钱包的地址，它是唯一的，每个钱包的地址肯定不一样。

你向别人收钱时，只要告诉对方你的钱包地址即可，对方向这个地址付款。

#### 3.交易过程
**一笔交易就是一个地址的比特币，转移到另一个地址**。比特币协议规定，申报交易时除了金额，转出比特币的一方还必须提供以下数据：
+ 上一笔交易的Hash（你从哪里得到这些比特币）
+ 本次交易双方的地址
+ 支付方的公钥
+ 支付方的私钥生成的数字签名

验证这笔交易是否属实，需要三步：
+ 找到上一笔交易，确认支付方的比特币来源
+ 算出支付方公钥的指纹，确认与支付方的地址一致，从而保证公钥属实
+ 使用公钥去解开数字签名，保证私钥属实

经过上面三步，就可以认定这笔交易是真实的。

#### 4.交易确认与区块链
**交易数据必须写入数据库，才算成立，对方才能真正收到钱**。比特币使用的数据库就是 **区块链**，所有的交易数据都会传送到矿工那里，矿工负责把这些交易写入区块链。

根据比特币协议，一个区块最大是1MB，而一笔交易数据大概是500字节左右，因此一个区块最多可以包含2000多笔交易，矿工负责把2000多笔交易打包在一起，组成一个区块，然后计算这个区块的哈希。

计算哈希的过程就叫做挖矿，需要大量的计算。矿工们也在竞争，看谁先算出哈希，谁就能第一个添加新区块进入区块链，从而获得收益。

一笔交易一旦写入了区块链，就无法反悔了。**比特币不存放在钱包或其他任何别的地方，而是只存在于区块链上面**。区块链记录了你参与的每一笔交易、获得过多少比特币、支付了多少比特币，因此可以计算出你拥有多少资产。

#### 5.矿工的收益
一开始（2008年）矿工挖到新区块的奖励是50个比特币，然后每4年减半。这也是比特币的供给增加机制，流通中的比特币都是诞生的。

此外，矿工开可以从每笔交易中抽成手续费，具体金额由支付方自愿决定。你完全可以一分不给矿工，但这样的话你的交易就没人处理，迟迟无法写入区块链得到确认。矿工们总是优先处理手续费最高的交易。

#### 6.其它
按照比特币协议规定，平均每10分钟诞生一个区块，最多包含2000多笔交易，也就是说比特网络每10分钟最多处理2000多笔交易，换算一下就是处理速度3-5笔/秒，这已经成为制约比特币发展的一个瓶颈。

当你发生了一笔支付，你所在的节点就会把这笔交易告诉另一个节点，直至传遍整个网络。矿工从网上收集各种新发生的交易，讲它们打包写入区块链。一旦写入成功，矿工所在节点的区块链就成为最新版本，其他节点都回来复制新增的区块，保证全网的区块链都是一致的。

数字货币的本质，就是一条可信的数据库记录。区块链的作用就是把这条记录永久保存下来，让任何人都可以查看，并且任何人都无法再修改。

区块链就是一个数据库，记载了所有的交易，用作中央记账系统，分布在无数个节点之上。

比特币有三个特点，保证了它的可信性：
+ **首先，它不会被（轻易）偷走**。因为必须要有别人的私钥才能使用别人的钱，正常情况下你拿不到别人的私钥。
+ **其次，它无法伪造**。每一个比特币都能追溯来源，而所有比特币都来源于矿工获得的奖励。
+ **最后，它无法大批生成**。原因和上一条一样，比特币发行速度稳定，现在每10分钟新增12.5个，每四年减半，最终停止增长。不会像纸币那样，政府滥发导致通货膨胀。
