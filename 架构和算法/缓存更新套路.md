# 缓存更新策略
[原文章出自酷壳](http://coolshell.cn/articles/17416.html)    
## 错误的方式    
**删除缓存，然后再更新数据库。** 两个并发操作，一个更新，一个查询。更新操作先删除缓存，再去数据库更新数据，查询没有命中缓存，去数据库查询数据，查询的数据再放入缓存，这样导致缓存中的数据是脏数据。    
## 缓存更新套路
> Cache Aside Pattern    

最常用的模式，具体逻辑如下：    
+ **失效：** 应用先从cache取数据，没有得到，则从数据库中取数据，成功后，放到缓存中。
+ **命中：** 应用程序从cache中取数据，取到后返回。
+ **更新：** 先把数据存到数据库中，成功后，再让缓存失效。    
为什么不是写完数据库后更新缓存？主要是怕两个并发的写操作导致脏数据。
是不是cache aside就没有并发问题？不是的，比如，一个是读操作，但是没有命中，然后就去数据库中取数据，此时来了一个写操作，写完数据库后，让缓存失效，然后，之前那个读操作再把老的数据放进去，所以会造成脏数据。    
但是，这个case理论上会出现，实际中出现的概率可能非常低。因为这个条件需要读缓存失效，且并发一个写操作。而实际上数据库写操作会比读操作慢很多，读操作必须在写操作前进入数据库操作，而又要晚于写操作更新缓存，所有这些条件都具备的概率并不大。    

> Read/Write Through Pattern

